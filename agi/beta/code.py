# agi

```json
{
    "files": [
        {
            "filename": "README.md",
            "content": "# AGI 项目\n\n一个使用 OpenAI API 实现的人工通用智能（AGI）代理原型。\n\n## 功能\n\n- 与用户进行连续对话\n- 使用 OpenAI GPT 模型处理自然语言\n- 支持工具调用（示例：获取当前时间）\n- 维护对话历史记录\n\n## 安装\n\n1. 克隆项目\n2. 安装依赖：`pip install -r requirements.txt`\n3. 设置环境变量：`export OPENAI_API_KEY='your-key'`\n\n## 运行\n\n`python main.py`\n\n## 项目结构\n\n- `main.py` - 主程序入口\n- `agi_agent.py` - AGI 代理核心类\n- `tools.py` - 工具函数定义\n- `config.py` - 配置管理\n- `requirements.txt` - 项目依赖\n\n## 注意\n\n这是一个简化版的 AGI 实现，展示了使用大语言模型构建智能代理的基本框架。真正的 AGI 需要更复杂的架构和功能。"
        },
        {
            "filename": "requirements.txt",
            "content": "openai>=1.0.0\npython-dotenv>=1.0.0\n"
        },
        {
            "filename": "config.py",
            "content": "\"\"\"\n配置管理模块\n\n负责加载和管理 AGI 系统的配置，特别是 API 密钥。\n\"\"\"\n\nimport os\nfrom typing import Optional\nfrom dotenv import load_dotenv\n\n# 加载 .env 文件中的环境变量\nload_dotenv()\n\n\ndef get_openai_api_key() -> str:\n    \"\"\"\n    获取 OpenAI API 密钥\n    \n    Returns:\n        str: API 密钥\n        \n    Raises:\n        ValueError: 如果未设置 API 密钥\n    \"\"\"\n    api_key = os.getenv(\"OPENAI_API_KEY\")\n    if not api_key:\n        raise ValueError(\n            \"OPENAI_API_KEY 未设置。请设置环境变量或创建 .env 文件。\"\n        )\n    return api_key\n\n\ndef get_model_name() -> str:\n    \"\"\"\n    获取要使用的 OpenAI 模型名称\n    \n    Returns:\n        str: 模型名称，默认为 gpt-3.5-turbo\n    \"\"\"\n    return os.getenv(\"OPENAI_MODEL\", \"gpt-3.5-turbo\")\n"
        },
        {
            "filename": "tools.py",
            "content": "\"\"\"\n工具模块\n\n定义 AGI 代理可以使用的工具函数。\n每个工具都应提供名称、描述和参数信息。\n\"\"\"\n\nimport json\nfrom datetime import datetime\nfrom typing import Dict, Any\n\n\ndef get_current_time() -> str:\n    \"\"\"\n    获取当前时间\n    \n    Returns:\n        str: 格式化的当前时间字符串\n    \"\"\"\n    return datetime.now().strftime(\"%Y-%m-%d %H:%M:%S\")\n\n\ndef get_tools() -> list:\n    \"\"\"\n    获取所有可用工具的描述\n    \n    返回 OpenAI 工具调用格式的工具列表\n    \n    Returns:\n        list: 工具描述列表\n    \"\"\"\n    return [\n        {\n            \"type\": \"function\",\n            \"function\": {\n                \"name\": \"get_current_time\",\n                \"description\": \"获取当前日期和时间\",\n                \"parameters\": {\n                    \"type\": \"object\",\n                    \"properties\": {},\n                    \"required\": []\n                }\n            }\n        }\n    ]\n\n\ndef execute_tool(tool_name: str) -> Dict[str, Any]:\n    \"\"\"\n    执行指定的工具\n    \n    Args:\n        tool_name: 工具名称\n        \n    Returns:\n        Dict[str, Any]: 工具执行结果\n        \n    Raises:\n        ValueError: 如果工具名称无效\n    \"\"\"\n    if tool_name == \"get_current_time\":\n        result = get_current_time()\n    else:\n        raise ValueError(f\"未知工具: {tool_name}\")\n    \n    return {\n        \"tool_name\": tool_name,\n        \"result\": result\n    }\n"
        },
        {
            "filename": "agi_agent.py",
            "content": "\"\"\"\nAGI 代理核心模块\n\n实现了一个基本的 AGI 代理，能够使用 OpenAI API 进行对话和工具调用。\n\"\"\"\n\nfrom typing import Dict, List, Any, Optional\nimport openai\nfrom openai.types.chat import ChatCompletion\n\nfrom config import get_openai_api_key, get_model_name\nfrom tools import get_tools, execute_tool\n\n\nclass AGIAgent:\n    \"\"\"AGI 代理类，负责处理对话和工具调用\"\"\"\n    \n    def __init__(self):\n        \"\"\"初始化 AGI 代理\"\"\"\n        self.client = openai.OpenAI(api_key=get_openai_api_key())\n        self.model = get_model_name()\n        self.conversation_history: List[Dict[str, str]] = []\n        \n    def add_message(self, role: str, content: str) -> None:\n        \"\"\"\n        添加消息到对话历史\n        \n        Args:\n            role: 消息角色（user/assistant/system）\n            content: 消息内容\n        \"\"\"\n        self.conversation_history.append({\n            \"role\": role,\n            \"content\": content\n        })\n    \n    def get_completion(self, messages: List[Dict[str, str]]) -> ChatCompletion:\n        \"\"\"\n        调用 OpenAI API 获取补全\n        \n        Args:\n            messages: 消息列表\n            \n        Returns:\n            ChatCompletion: OpenAI 响应对象\n        \"\"\"\n        try:\n            response = self.client.chat.completions.create(\n                model=self.model,\n                messages=messages,\n                tools=get_tools(),\n                tool_choice=\"auto\",\n            )\n            return response\n        except Exception as e:\n            raise Exception(f\"调用 OpenAI API 失败: {str(e)}\")\n    \n    def process_tool_calls(self, tool_calls: Any) -> List[Dict[str, str]]:\n        \"\"\"\n        处理工具调用\n        \n        Args:\n            tool_calls: 工具调用列表\n            \n        Returns:\n            List[Dict[str, str]]: 工具执行结果消息列表\n        \"\"\"\n        tool_messages = []\n        \n        for tool_call in tool_calls:\n            tool_name = tool_call.function.name\n            \n            try:\n                # 执行工具\n                tool_result = execute_tool(tool_name)\n                \n                # 添加工具响应消息\n                tool_messages.append({\n                    \"role\": \"tool\",\n                    \"tool_call_id\": tool_call.id,\n                    \"content\": str(tool_result[\"result\"])\n                })\n                \n                print(f\"[工具调用] {tool_name}: {tool_result['result']}\")\n                \n            except Exception as e:\n                error_msg = f\"执行工具 {tool_name} 失败: {str(e)}\"\n                tool_messages.append({\n                    \"role\": \"tool\",\n                    \"tool_call_id\": tool_call.id,\n                    \"content\": error_msg\n                })\n                print(f\"[错误] {error_msg}\")\n        \n        return tool_messages\n    \n    def process_message(self, user_input: str) -> str:\n        \"\"\"\n        处理用户输入并返回助理响应\n        \n        Args:\n            user_input: 用户输入文本\n            \n        Returns:\n            str: 助理响应文本\n        \"\"\"\n        # 添加用户消息到历史\n        self.add_message(\"user\", user_input)\n        \n        # 获取初始响应\n        response = self.get_completion(self.conversation_history)\n        response_message = response.choices[0].message\n        \n        # 添加助理响应到历史\n        self.conversation_history.append({\n            \"role\": \"assistant\",\n            \"content\": response_message.content or \"\",\n            \"tool_calls\": response_message.tool_calls\n        })\n        \n        # 检查是否有工具调用\n        if response_message.tool_calls:\n            # 处理工具调用\n            tool_messages = self.process_tool_calls(response_message.tool_calls)\n            \n            # 添加工具消息到历史\n            self.conversation_history.extend(tool_messages)\n            \n            # 获取工具调用后的最终响应\n            second_response = self.get_completion(self.conversation_history)\n            final_message = second_response.choices[0].message\n            \n            # 添加最终响应到历史\n            self.add_message(\"assistant\", final_message.content or \"\")\n            \n            return final_message.content or \"\"\n        \n        return response_message.content or \"\"\n    \n    def reset_conversation(self) -> None:\n        \"\"\"重置对话历史\"\"\"\n        self.conversation_history = []\n        print(\"对话历史已重置\")\n    \n    def get_conversation_summary(self) -> str:\n        \"\"\"\n        获取对话摘要\n        \n        Returns:\n            str: 对话摘要\n        \"\"\"\n        return f\"对话轮次: {len(self.conversation_history)}\"\n"
        },
        {
            "filename": "main.py",
            "content": "\"\"\"\nAGI 主程序入口\n\n提供命令行界面与 AGI 代理交互。\n\"\"\"\n\nimport sys\nfrom agi_agent import AGIAgent\n\n\ndef main():\n    \"\"\"主函数\"\"\"\n    print(\"=\" * 50)\n    print(\"AGI 代理系统\")\n    print(\"输入 'quit' 退出，'reset' 重置对话，'summary' 查看摘要\")\n    print(\"=\" * 50)\n    \n    # 初始化 AGI 代理\n    try:\n        agent = AGIAgent()\n        print(\"AGI 代理初始化成功！\")\n    except Exception as e:\n        print(f\"初始化失败: {e}\")\n        return\n    \n    # 主交互循环\n    while True:\n        try:\n            # 获取用户输入\n            user_input = input(\"\\n你: \").strip()\n            \n            # 检查特殊命令\n            if user_input.lower() == 'quit':\n                print(\"再见！\")\n                break\n            elif user_input.lower() == 'reset':\n                agent.reset_conversation()\n                continue\n            elif user_input.lower() == 'summary':\n                print(agent.get_conversation_summary())\n                continue\n            elif not user_input:\n                print(\"请输入内容...\")\n                continue\n            \n            # 处理用户输入\n            response = agent.process_message(user_input)\n            \n            # 显示响应\n            print(f\"\\nAGI: {response}\")\n            \n        except KeyboardInterrupt:\n            print(\"\\n\\n程序被用户中断\")\n            break\n        except Exception as e:\n            print(f\"\\n错误: {e}\")\n            continue\n\n\nif __name__ == \"__main__\":\n    main()\n"
        }
    ]
}
```