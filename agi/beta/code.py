# agi

```json
{
    "files": [
        {
            "filename": "agi_core.py",
            "content": "#!/usr/bin/env python3\n\"\"\"\nAGI核心模块 - 实现通用人工智能的基础框架\n\n作为初级工程师，我负责实现一个基于OpenAI API的AGI系统基础架构。\n这个模块提供了AGI的核心功能，包括对话管理、任务分解和工具调用。\n\"\"\"\n\nimport os\nimport json\nimport logging\nfrom typing import Dict, List, Any, Optional, Callable\nfrom dataclasses import dataclass, asdict\nfrom datetime import datetime\n\nimport openai\nfrom dotenv import load_dotenv\n\n# 加载环境变量\nload_dotenv()\n\n# 配置日志\nlogging.basicConfig(\n    level=logging.INFO,\n    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'\n)\nlogger = logging.getLogger(__name__)\n\n\n@dataclass\nclass Message:\n    \"\"\"对话消息数据结构\"\"\"\n    role: str  # 'system', 'user', 'assistant', 'function'\n    content: str\n    name: Optional[str] = None\n    function_call: Optional[Dict] = None\n\n    def to_dict(self) -> Dict:\n        \"\"\"转换为API所需的字典格式\"\"\"\n        result = {\"role\": self.role, \"content\": self.content}\n        if self.name:\n            result[\"name\"] = self.name\n        if self.function_call:\n            result[\"function_call\"] = self.function_call\n        return result\n\n\n@dataclass\nclass Function:\n    \"\"\"工具函数定义\"\"\"\n    name: str\n    description: str\n    parameters: Dict[str, Any]\n    function: Callable\n\n\nclass AGICore:\n    \"\"\"AGI核心类 - 处理与OpenAI API的交互和任务管理\"\"\"\n    \n    def __init__(self, model: str = \"gpt-4\", temperature: float = 0.7):\n        \"\"\"初始化AGI核心\n        \n        Args:\n            model: 使用的OpenAI模型\n            temperature: 生成文本的随机性\n        \"\"\"\n        self.model = model\n        self.temperature = temperature\n        self.conversation_history: List[Message] = []\n        self.functions: Dict[str, Function] = {}\n        self.function_call_history: List[Dict] = []\n        \n        # 初始化OpenAI客户端\n        api_key = os.getenv(\"OPENAI_API_KEY\")\n        if not api_key:\n            raise ValueError(\"请设置OPENAI_API_KEY环境变量\")\n        \n        self.client = openai.OpenAI(api_key=api_key)\n        \n        # 添加系统提示\n        system_prompt = \"\"\"你是一个通用人工智能（AGI）系统。你的目标是理解用户的需求，\n        分解复杂任务，使用可用工具解决问题，并提供有帮助的回应。\n        你可以使用各种工具来获取信息、执行计算或与外部系统交互。\n        \"\"\"\n        self.add_message(\"system\", system_prompt)\n        \n        logger.info(f\"AGI核心初始化完成，使用模型: {model}\")\n    \n    def add_message(self, role: str, content: str, name: Optional[str] = None) -> None:\n        \"\"\"添加消息到对话历史\"\"\"\n        message = Message(role=role, content=content, name=name)\n        self.conversation_history.append(message)\n        logger.debug(f\"添加消息: {role} - {content[:50]}...\")\n    \n    def register_function(self, function: Function) -> None:\n        \"\"\"注册工具函数\"\"\"\n        self.functions[function.name] = function\n        logger.info(f\"注册函数: {function.name}\")\n    \n    def call_openai(self) -> Dict[str, Any]:\n        \"\"\"调用OpenAI API\"\"\"\n        try:\n            # 准备消息\n            messages = [msg.to_dict() for msg in self.conversation_history]\n            \n            # 准备函数定义\n            functions = []\n            for func in self.functions.values():\n                functions.append({\n                    \"name\": func.name,\n                    \"description\": func.description,\n                    \"parameters\": func.parameters\n                })\n            \n            # 调用API\n            if functions:\n                response = self.client.chat.completions.create(\n                    model=self.model,\n                    messages=messages,\n                    functions=functions,\n                    function_call=\"auto\",\n                    temperature=self.temperature\n                )\n            else:\n                response = self.client.chat.completions.create(\n                    model=self.model,\n                    messages=messages,\n                    temperature=self.temperature\n                )\n            \n            return response.choices[0].message\n            \n        except Exception as e:\n            logger.error(f\"调用OpenAI API失败: {e}\")\n            raise\n    \n    def execute_function_call(self, function_call: Dict[str, Any]) -> str:\n        \"\"\"执行函数调用\"\"\"\n        function_name = function_call[\"name\"]\n        function_args = json.loads(function_call[\"arguments\"])\n        \n        logger.info(f\"执行函数调用: {function_name} with args: {function_args}\")\n        \n        if function_name not in self.functions:\n            return f\"错误: 函数 '{function_name}' 未注册\"\n        \n        try:\n            # 执行函数\n            function = self.functions[function_name]\n            result = function.function(**function_args)\n            \n            # 记录函数调用历史\n            self.function_call_history.append({\n                \"function\": function_name,\n                \"arguments\": function_args,\n                \"result\": result,\n                \"timestamp\": datetime.now().isoformat()\n            })\n            \n            return str(result)\n            \n        except Exception as e:\n            error_msg = f\"执行函数 '{function_name}' 时出错: {str(e)}\"\n            logger.error(error_msg)\n            return error_msg\n    \n    def process_query(self, user_query: str) -> str:\n        \"\"\"处理用户查询\"\"\"\n        logger.info(f\"处理查询: {user_query}\")\n        \n        # 添加用户消息\n        self.add_message(\"user\", user_query)\n        \n        # 循环处理，直到获得最终回答\n        max_iterations = 10\n        for iteration in range(max_iterations):\n            logger.debug(f\"处理迭代 {iteration + 1}/{max_iterations}\")\n            \n            # 调用OpenAI API\n            response = self.call_openai()\n            \n            # 检查是否需要函数调用\n            if hasattr(response, 'function_call') and response.function_call:\n                # 执行函数调用\n                function_result = self.execute_function_call({\n                    \"name\": response.function_call.name,\n                    \"arguments\": response.function_call.arguments\n                })\n                \n                # 添加函数调用结果到对话历史\n                self.add_message(\n                    \"function\",\n                    function_result,\n                    name=response.function_call.name\n                )\n                \n                # 继续下一轮对话\n                continue\n            \n            else:\n                # 获得最终回答\n                assistant_response = response.content\n                self.add_message(\"assistant\", assistant_response)\n                logger.info(f\"获得最终回答: {assistant_response[:100]}...\")\n                return assistant_response\n        \n        # 如果达到最大迭代次数\n        error_msg = \"达到最大处理迭代次数，可能陷入循环\"\n        logger.warning(error_msg)\n        return error_msg\n    \n    def get_conversation_summary(self) -> str:\n        \"\"\"获取对话摘要\"\"\"\n        summary = f\"对话历史 ({len(self.conversation_history)} 条消息):\\n\"\n        for i, msg in enumerate(self.conversation_history):\n            role = msg.role\n            content_preview = msg.content[:50] + \"...\" if len(msg.content) > 50 else msg.content\n            summary += f\"{i+1}. [{role}] {content_preview}\\n\"\n        return summary\n    \n    def clear_conversation(self) -> None:\n        \"\"\"清空对话历史\"\"\"\n        # 保留系统提示\n        system_messages = [msg for msg in self.conversation_history if msg.role == \"system\"]\n        self.conversation_history = system_messages\n        logger.info(\"对话历史已清空\")\n\n\n# 预定义的工具函数\n\ndef calculator(operation: str, a: float, b: float) -> float:\n    \"\"\"计算器工具\n    \n    Args:\n        operation: 操作类型 (add, subtract, multiply, divide)\n        a: 第一个数字\n        b: 第二个数字\n    \n    Returns:\n        计算结果\n    \"\"\"\n    operations = {\n        \"add\": lambda x, y: x + y,\n        \"subtract\": lambda x, y: x - y,\n        \"multiply\": lambda x, y: x * y,\n        \"divide\": lambda x, y: x / y if y != 0 else \"错误: 除数不能为零\"\n    }\n    \n    if operation not in operations:\n        return f\"错误: 不支持的操作 '{operation}'\"\n    \n    return operations[operation](a, b)\n\n\ndef get_current_time() -> str:\n    \"\"\"获取当前时间\"\"\"\n    return datetime.now().strftime(\"%Y-%m-%d %H:%M:%S\")\n\n\ndef web_search(query: str) -> str:\n    \"\"\"模拟网络搜索（实际实现需要接入搜索API）\"\"\"\n    # 注意：这是一个模拟函数，实际使用时需要替换为真正的搜索API\n    return f\"模拟搜索 '{query}' 的结果: 这是关于 {query} 的模拟搜索结果。\"\n\n\nif __name__ == \"__main__\":\n    \"\"\"示例用法\"\"\"\n    # 创建AGI实例\n    agi = AGICore(model=\"gpt-3.5-turbo\", temperature=0.7)\n    \n    # 注册工具函数\n    agi.register_function(Function(\n        name=\"calculator\",\n        description=\"执行数学计算\",\n        parameters={\n            \"type\": \"object\",\n            \"properties\": {\n                \"operation\": {\n                    \"type\": \"string\",\n                    \"enum\": [\"add\", \"subtract\", \"multiply\", \"divide\"],\n                    \"description\": \"要执行的操作类型\"\n                },\n                \"a\": {\n                    \"type\": \"number\",\n                    \"description\": \"第一个数字\"\n                },\n                \"b\": {\n                    \"type\": \"number\",\n                    \"description\": \"第二个数字\"\n                }\n            },\n            \"required\": [\"operation\", \"a\", \"b\"]\n        },\n        function=calculator\n    ))\n    \n    agi.register_function(Function(\n        name=\"get_current_time\",\n        description=\"获取当前日期和时间\",\n        parameters={\n            \"type\": \"object\",\n            \"properties\": {},\n            \"required\": []\n        },\n        function=get_current_time\n    ))\n    \n    agi.register_function(Function(\n        name=\"web_search\",\n        description=\"在互联网上搜索信息\",\n        parameters={\n            \"type\": \"object\",\n            \"properties\": {\n                \"query\": {\n                    \"type\": \"string\",\n                    \"description\": \"搜索查询\"\n                }\n            },\n            \"required\": [\"query\"]\n        },\n        function=web_search\n    ))\n    \n    # 示例对话\n    print(\"=== AGI系统演示 ===\\n\")\n    \n    queries = [\n        \"你好，请介绍一下自己\",\n        \"计算一下 15 乘以 27 等于多少\",\n        \"现在是什么时间？\",\n        \"搜索一下关于人工智能的最新发展\"\n    ]\n    \n    for query in queries:\n        print(f\"用户: {query}\")\n        response = agi.process_query(query)\n        print(f\"AGI: {response}\\n\")\n    \n    # 显示对话摘要\n    print(\"\\n=== 对话摘要 ===\")\n    print(agi.get_conversation_summary())"
        },
        {
            "filename": "requirements.txt",
            "content": "# AGI项目依赖\n# 作为初级工程师，我确保列出了所有必要的依赖\n\n# OpenAI API客户端\nopenai>=1.3.0\n\n# 环境变量管理\npython-dotenv>=1.0.0\n\n# 日志和工具\n# 标准库已包含所需的大部分功能\n\n# 可选：用于更高级功能的额外依赖\n# requests>=2.31.0  # 用于HTTP请求\n# numpy>=1.24.0    # 用于数值计算\n# pandas>=2.0.0    # 用于数据处理"
        },
        {
            "filename": "README.md",
            "content": "# AGI项目 - 通用人工智能系统\n\n## 项目概述\n\n这是一个基于OpenAI API的通用人工智能（AGI）系统实现。作为初级工程师，我负责构建这个系统的核心框架，使其能够理解自然语言、分解复杂任务、使用工具解决问题，并进行多轮对话。\n\n## 功能特性\n\n- **对话管理**: 维护完整的对话历史，支持多轮交互\n- **工具调用**: 可扩展的工具系统，支持函数调用\n- **任务分解**: 自动将复杂问题分解为可执行的步骤\n- **错误处理**: 健壮的错误处理和日志记录\n- **可扩展性**: 易于添加新的工具和功能\n\n## 快速开始\n\n### 1. 安装依赖\n\n```bash\npip install -r requirements.txt\n```\n\n### 2. 设置环境变量\n\n创建 `.env` 文件并添加你的OpenAI API密钥：\n\n```env\nOPENAI_API_KEY=your-api-key-here\n```\n\n### 3. 运行示例\n\n```bash\npython agi_core.py\n```\n\n## 项目结构\n\n```\nagi/\n├── agi_core.py          # 核心AGI实现\n├── requirements.txt     # 项目依赖\n├── README.md           # 项目文档\n└── .env               # 环境变量配置（需自行创建）\n```\n\n## 核心组件\n\n### AGICore类\n\n主要类，负责：\n- 管理对话历史\n- 调用OpenAI API\n- 执行工具函数\n- 处理用户查询\n\n### 工具函数系统\n\n支持注册自定义工具函数，包括：\n1. **计算器**: 执行基本数学运算\n2. **时间获取**: 获取当前时间\n3. **网络搜索**: 模拟搜索功能（可扩展为真实搜索）\n\n## 扩展系统\n\n### 添加新工具\n\n1. 定义工具函数\n2. 创建Function对象\n3. 使用`register_function()`方法注册\n\n示例：\n```python\ndef my_tool(param1: str, param2: int) -> str:\n    \"\"\"我的自定义工具\"\"\"\n    return f\"处理结果: {param1} - {param2}\"\n\nagi.register_function(Function(\n    name=\"my_tool\",\n    description=\"我的自定义工具描述\",\n    parameters={\n        \"type\": \"object\",\n        \"properties\": {\n            \"param1\": {\"type\": \"string\"},\n            \"param2\": {\"type\": \"number\"}\n        },\n        \"required\": [\"param1\", \"param2\"]\n    },\n    function=my_tool\n))\n```\n\n## 配置选项\n\n- **模型选择**: 支持gpt-3.5-turbo, gpt-4等\n- **温度参数**: 控制生成文本的随机性\n- **最大迭代**: 防止无限循环\n\n## 注意事项\n\n1. **API成本**: 注意OpenAI API的使用成本\n2. **速率限制**: 遵守API的速率限制\n3. **错误处理**: 系统包含基本的错误处理，但生产环境需要更完善的机制\n4. **安全性**: 注意工具函数的安全性，避免执行危险操作\n\n## 未来改进\n\n作为初级工程师，我认识到这个系统还有很多改进空间：\n\n1. **记忆系统**: 添加长期记忆和知识库\n2. **多模态支持**: 支持图像、音频等输入\n3. **计划系统**: 更复杂的任务规划和执行\n4. **自我改进**: 学习从经验中改进\n5. **评估系统**: 评估AGI的性能和准确性\n\n## 贡献指南\n\n欢迎提交Issue和Pull Request来改进这个项目。\n\n## 许可证\n\nMIT License"
        },
        {
            "